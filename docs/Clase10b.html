<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Murillo">

<title>Clase10b</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Clase10b_files/libs/clipboard/clipboard.min.js"></script>
<script src="Clase10b_files/libs/quarto-html/quarto.js"></script>
<script src="Clase10b_files/libs/quarto-html/popper.min.js"></script>
<script src="Clase10b_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Clase10b_files/libs/quarto-html/anchor.min.js"></script>
<link href="Clase10b_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Clase10b_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Clase10b_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Clase10b_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Clase10b_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Clase10b</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Murillo </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>En esta clase veremos dos temas: 1) Supervivencia de nidos enfoque bayesiano 2) Captura-Recaptura enfoque bayesiano</p>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href="">Supervivencia de nidos</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href="">cargar paquetes</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false" href="">Cargar base de datos</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false" href="">Preparar datos para el modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-5" role="tab" aria-controls="tabset-1-5" aria-selected="false" href="">Crear funcion del modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-6" role="tab" aria-controls="tabset-1-6" aria-selected="false" href="">Definir parametros del modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-7" role="tab" aria-controls="tabset-1-7" aria-selected="false" href="">Ajustar modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-8-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-8" role="tab" aria-controls="tabset-1-8" aria-selected="false" href="">Revisar parametros del modelo</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-9-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-9" role="tab" aria-controls="tabset-1-9" aria-selected="false" href="">Preparar datos a graficar</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-10-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-10" role="tab" aria-controls="tabset-1-10" aria-selected="false" href="">Graficar</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>Para este analisi necesitaremos instalar el software <a href="https://sourceforge.net/projects/mcmc-jags/">Jags</a></p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jagsUI)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lubridate' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.3     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>NidosPatos <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/duck_nests.csv"</span>, </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">header=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La base de datos duck_NidoPatos1s.csv contiene una muestra aleatoria de registro para tres anos, divididos en 12 bloques.</p>
<p>Primero estandarizaremos la visita inicial a cada nido</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>NidoPatos1 <span class="ot">&lt;-</span> NidosPatos <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">init_stadard =</span> (init<span class="sc">-</span> <span class="fu">mean</span>(init))<span class="sc">/</span><span class="fu">sd</span>(init))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>Crearemos una lista con las covariables que pueden implementarce en el modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dsr.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n.nests =</span> <span class="fu">dim</span>(NidoPatos1)[<span class="dv">1</span>], </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.yrs =</span> <span class="fu">max</span>(NidoPatos1<span class="sc">$</span>year), </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.areas =</span> <span class="fu">max</span>(NidoPatos1<span class="sc">$</span>block), </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n.spp =</span> <span class="fu">max</span>(NidoPatos1<span class="sc">$</span>species),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">year =</span> NidoPatos1<span class="sc">$</span>year, </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">area =</span> NidoPatos1<span class="sc">$</span>block, </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">spp =</span> NidoPatos1<span class="sc">$</span>species,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">expos =</span> NidoPatos1<span class="sc">$</span>expos, </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">init =</span> NidoPatos1<span class="sc">$</span>init_stadard,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">age =</span> NidoPatos1<span class="sc">$</span>age_start, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">survive =</span> NidoPatos1<span class="sc">$</span>survive,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dist =</span> NidoPatos1<span class="sc">$</span>dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-5-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shaffer's nest survival model, coded for JAGS</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>{<span class="fu">sink</span>(<span class="st">"dsr.jags"</span>); <span class="fu">cat</span>(<span class="st">"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st"># modeling daily nest survival on the logit scale</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.mu ~ dnorm(0, 0.33) # intercept, note this is vague (0,1) on real scale</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st"># fixed effects for nest level covariates (all are linear on logit scale)</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st">b.age ~ dnorm(0, 1) # nest age effect</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">b.dist ~ dnorm(0, 1) # distance from management edge</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st">b.init ~ dnorm(0, 1) # nest initiation date effect</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st"># note: I'm modeling site and year as crossed random effects - they could also be nested</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st"># random site effects</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.area.sd ~ dunif(0.01, 1) # random site effect</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.area.tau &lt;- pow(dsr.area.sd, -2)</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="st">for (j in 1:n.areas){</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="st">  eps.area[j] ~ dnorm(0, dsr.area.tau)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="st"># random year effects</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.yr.sd ~ dunif(0.01, 1) # random year effect</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.yr.tau &lt;- pow(dsr.yr.sd, -2)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:n.yrs){</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="st">  eps.yr[i] ~ dnorm(0, dsr.yr.tau)</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="st"># random species effects</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.spp.sd ~ dunif(0.01, 1) # random species effect</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.spp.tau &lt;- pow(dsr.spp.sd, -2)</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:n.spp){</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="st">  eps.spp[i] ~ dnorm(0, dsr.spp.tau)</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:n.nests){</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="st">  for (j in 1:expos[i]){</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="st">      # daily survival is function of mean dsr, nest age effect, distance from edge,</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a><span class="st">      # initiation date, and random effects for area, year, and species</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="st">      logitS[i,j] &lt;- dsr.mu + b.age*(age[i]+j-1) + b.dist*dist[i] + b.init*init[i] + </span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="st">        eps.area[area[i]] + eps.yr[year[i]] + eps.spp[spp[i]]</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="st">      logit(S[i,j]) &lt;- logitS[i,j] # convert back to real scale</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="st">    IS[i] &lt;- prod(S[i,1:expos[i]]) # prob of surviving entire exposure interval</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="st">    survive[i] ~ dbern(IS[i]) # does nest survive this nest check interval?</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a><span class="st">  } # end jags model</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,<span class="at">fill =</span> <span class="cn">TRUE</span>); <span class="fu">sink</span>()}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-6-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>parms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dsr.mu"</span>, <span class="st">"b.age"</span>, <span class="st">"b.dist"</span>, <span class="st">"b.init"</span>, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">"dsr.area.sd"</span>, <span class="st">"dsr.yr.sd"</span>, <span class="st">"dsr.spp.sd"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">"eps.area"</span>, <span class="st">"eps.yr"</span>, <span class="st">"eps.spp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-7-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MCMC settings</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>na <span class="ot">&lt;-</span> <span class="dv">1000</span>; ni <span class="ot">&lt;-</span> <span class="dv">1100</span>; nt <span class="ot">&lt;-</span> <span class="dv">1</span>        </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="dv">100</span>; nc <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># call jags (~ 4 min)</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>nest.success <span class="ot">&lt;-</span> <span class="fu">jagsUI</span>(dsr.data, <span class="at">inits =</span> <span class="cn">NULL</span>, parms, <span class="st">"dsr.jags"</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n.adapt =</span> na, <span class="at">n.chains =</span> nc, <span class="at">n.thin =</span> nt, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n.iter =</span> ni, <span class="at">n.burnin =</span> nb, <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Processing function input....... 

Done. 
 
Beginning parallel processing using 3 cores. Console output will be suppressed.

Parallel processing completed.

Calculating statistics....... 

Done. </code></pre>
</div>
</div>
</div>
<div id="tabset-1-8" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-8-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nest.success, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>JAGS output for model 'dsr.jags', generated by jagsUI.
Estimates based on 3 chains of 1100 iterations,
adaptation = 1000 iterations (sufficient),
burn-in = 100 iterations and thin rate = 1,
yielding 3000 total samples from the joint posterior. 
MCMC ran in parallel for 2.133 minutes at time 2024-02-02 01:50:02.303397.

                 mean     sd     2.5%      50%    97.5% overlap0      f   Rhat
dsr.mu         2.8282 0.3416   2.1527   2.8293   3.4862    FALSE 1.0000 1.0431
b.age          0.0500 0.0113   0.0280   0.0500   0.0707    FALSE 1.0000 1.0067
b.dist        -0.0048 0.0807  -0.1531  -0.0066   0.1595     TRUE 0.5320 1.0023
b.init        -0.1689 0.0980  -0.3629  -0.1668   0.0153     TRUE 0.9603 1.0033
dsr.area.sd    0.4234 0.1551   0.1564   0.4120   0.7731    FALSE 1.0000 1.0114
dsr.yr.sd      0.2979 0.2416   0.0199   0.2291   0.9097    FALSE 1.0000 1.0066
dsr.spp.sd     0.2069 0.1641   0.0160   0.1612   0.6513    FALSE 1.0000 1.0129
eps.area[1]    0.4311 0.3611  -0.1549   0.3913   1.2629     TRUE 0.9083 1.0115
eps.area[2]   -0.1481 0.2523  -0.6808  -0.1384   0.3208     TRUE 0.7177 0.9998
eps.area[3]    0.2248 0.2582  -0.2647   0.2126   0.7633     TRUE 0.8127 1.0033
eps.area[4]   -0.1038 0.3421  -0.7989  -0.0946   0.5582     TRUE 0.6170 1.0037
eps.area[5]    0.0801 0.2753  -0.4647   0.0699   0.6587     TRUE 0.6100 1.0003
eps.area[6]   -0.5887 0.2816  -1.1531  -0.5828  -0.0442    FALSE 0.9853 1.0038
eps.area[7]   -0.2251 0.2490  -0.7226  -0.2191   0.2542     TRUE 0.8177 1.0014
eps.area[8]   -0.2023 0.2472  -0.7018  -0.1941   0.2659     TRUE 0.7960 1.0009
eps.area[9]    0.3954 0.3055  -0.1363   0.3728   1.0613     TRUE 0.9167 1.0051
eps.area[10]   0.1536 0.2441  -0.3215   0.1458   0.6554     TRUE 0.7443 1.0053
eps.area[11]   0.0499 0.3701  -0.6910   0.0440   0.7946     TRUE 0.5537 1.0054
eps.area[12]   0.1577 0.2283  -0.2831   0.1492   0.6240     TRUE 0.7553 1.0015
eps.yr[1]      0.0068 0.2146  -0.4968   0.0038   0.4652     TRUE 0.5143 1.0399
eps.yr[2]      0.1530 0.2329  -0.2406   0.1070   0.7086     TRUE 0.7677 1.0254
eps.yr[3]     -0.0540 0.2066  -0.5482  -0.0338   0.3447     TRUE 0.6253 1.0562
eps.spp[1]     0.0451 0.1488  -0.2403   0.0280   0.3726     TRUE 0.6237 1.0120
eps.spp[2]     0.0985 0.1855  -0.1947   0.0539   0.5288     TRUE 0.6857 1.0013
eps.spp[3]    -0.0752 0.1514  -0.4522  -0.0482   0.1994     TRUE 0.6833 1.0144
eps.spp[4]    -0.0444 0.1561  -0.4131  -0.0236   0.2508     TRUE 0.6030 1.0063
eps.spp[5]    -0.0697 0.1993  -0.5503  -0.0338   0.3017     TRUE 0.6383 1.0116
eps.spp[6]    -0.0242 0.2321  -0.5519  -0.0068   0.4605     TRUE 0.5377 1.0142
eps.spp[7]     0.1013 0.2535  -0.2745   0.0437   0.7635     TRUE 0.6537 1.0008
eps.spp[8]     0.0300 0.2453  -0.4662   0.0126   0.6249     TRUE 0.5487 1.0016
deviance     764.5684 5.9800 754.6628 763.7503 777.7265    FALSE 1.0000 1.0002
             n.eff
dsr.mu          72
b.age         3000
b.dist         991
b.init        1405
dsr.area.sd    181
dsr.yr.sd      320
dsr.spp.sd     429
eps.area[1]    183
eps.area[2]   3000
eps.area[3]    572
eps.area[4]    746
eps.area[5]   3000
eps.area[6]    584
eps.area[7]   1320
eps.area[8]   2244
eps.area[9]    459
eps.area[10]   444
eps.area[11]  3000
eps.area[12]  1163
eps.yr[1]       66
eps.yr[2]       92
eps.yr[3]       57
eps.spp[1]     237
eps.spp[2]    3000
eps.spp[3]     488
eps.spp[4]     954
eps.spp[5]    3000
eps.spp[6]     437
eps.spp[7]    2725
eps.spp[8]    2109
deviance      3000

Successful convergence based on Rhat values (all &lt; 1.1). 
Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
For each parameter, n.eff is a crude measure of effective sample size. 

overlap0 checks if 0 falls in the parameter's 95% credible interval.
f is the proportion of the posterior with the same sign as the mean;
i.e., our confidence that the parameter is positive or negative.

DIC info: (pD = var(deviance)/2) 
pD = 17.9 and DIC = 782.4576 
DIC is an estimate of expected predictive error (lower is better).</code></pre>
</div>
</div>
</div>
<div id="tabset-1-9" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-9-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">35</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>dsr <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>mean<span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>mean<span class="sc">$</span>b.age<span class="sc">*</span>age)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>dsr_IC2<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>q2<span class="fl">.5</span><span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>q2<span class="fl">.5</span><span class="sc">$</span>b.age<span class="sc">*</span>age)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>dsr_IC97<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>q97<span class="fl">.5</span><span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>q97<span class="fl">.5</span><span class="sc">$</span>b.age<span class="sc">*</span>age)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>Age_df_pre <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dsr =</span>dsr,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">IC95L =</span> dsr_IC2<span class="fl">.5</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">IC95H =</span> dsr_IC97<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-10" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-10-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Age_df_pre, <span class="fu">aes</span>(<span class="at">x=</span> age, <span class="at">y =</span>dsr)) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span> IC95L,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax=</span> IC95H),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha=</span> <span class="fl">0.4</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span> <span class="st">"lightgreen"</span>)<span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Clase10b_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<section id="ejemplo-con-mallard-dsr" class="level2">
<h2 class="anchored" data-anchor-id="ejemplo-con-mallard-dsr">Ejemplo con mallard dsr</h2>
</section>
<div class="panle-tabset">
<section id="cargar-base-de-datos-1" class="level2">
<h2 class="anchored" data-anchor-id="cargar-base-de-datos-1">Cargar base de datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Mallard <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/Mallar.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mallard1 <span class="ot">&lt;-</span> Mallard <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Habitat =</span> <span class="fu">case_when</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    Native <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Native"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    Planted <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Planted"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    Roadside <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Roadside"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Wetland"</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="preparar-datos-para-el-modelo-1" class="level2">
<h2 class="anchored" data-anchor-id="preparar-datos-para-el-modelo-1">Preparar datos para el modelo</h2>
<p>Crearemos una lista con las covariables que pueden implementarce en el modelo</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>dsr.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n.nests =</span> <span class="fu">dim</span>(mallard1)[<span class="dv">1</span>], </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">FirstFound =</span> mallard1<span class="sc">$</span>FirstFound, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">LastPresent =</span> mallard1<span class="sc">$</span>LastPresent, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">LastChecked =</span> mallard1<span class="sc">$</span>LastChecked,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Fate=</span> mallard1<span class="sc">$</span>Fate,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Freq=</span> mallard1<span class="sc">$</span>Freq,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Robel =</span> mallard1<span class="sc">$</span>Robel,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PpnGrass =</span> mallard1<span class="sc">$</span>PpnGrass,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">AgeFound =</span> mallard1<span class="sc">$</span>AgeFound,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">AgeDay1 =</span> mallard1<span class="sc">$</span>AgeDay1,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Habitat =</span> mallard1<span class="sc">$</span>Habitat)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>dsr.data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n.nests =</span> <span class="fu">dim</span>(mallard1)[<span class="dv">1</span>], </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Fate=</span> mallard1<span class="sc">$</span>Fate,</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">PpnGrass =</span> mallard1<span class="sc">$</span>PpnGrass,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">AgeFound =</span> mallard1<span class="sc">$</span>AgeFound,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Freq=</span> mallard1<span class="sc">$</span>Freq,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">Age =</span> mallard1<span class="sc">$</span>LastPresent <span class="sc">-</span> mallard1<span class="sc">$</span>FirstFound)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="crear-funcion-del-modelo-1" class="level2">
<h2 class="anchored" data-anchor-id="crear-funcion-del-modelo-1">Crear funcion del modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Shaffer's nest survival model, coded for JAGS</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>{<span class="fu">sink</span>(<span class="st">"dsr.jags"</span>); <span class="fu">cat</span>(<span class="st">"</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="st"># modeling daily nest survival on the logit scale</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="st">dsr.mu ~ dnorm(0, 0.33) # intercept, note this is vague (0,1) on real scale</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="st"># fixed effects for nest level covariates (all are linear on logit scale)</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="st">b.AgeFound ~ dnorm(0, 1) # nest age effect</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="st"># b.dist ~ dnorm(0, 1) # distance from management edge</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="st">b.AgeDay1 ~ dnorm(0, 1) # nest initiation date effect</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="st">b.PpnGrass ~ dnorm(0, 1) </span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="st">#b.Habitat ~ dnorm(0, 1)</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="st">b.Age ~ dnorm(0,1)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="st"># note: I'm modeling site and year as crossed random effects - they could also be nested</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="st"># random site effects</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="st">#dsr.Habitat.sd ~ dunif(0.01, 1) # random site effect</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="st">#dsr.Habitat.tau &lt;- pow(dsr.Habitat.sd, -2)</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="st">#for (j in 1:Habitat){</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="st">#  eps.Habitat[j] ~ dnorm(0, dsr.Habitat.tau)</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="st">#}</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="st"># random year effects</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="st">#dsr.yr.sd ~ dunif(0.01, 1) # random year effect</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="st">#dsr.yr.tau &lt;- pow(dsr.yr.sd, -2)</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="st">#for (i in 1:n.yrs){</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="st">#  eps.yr[i] ~ dnorm(0, dsr.yr.tau)</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="st">#}</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="st"># random species effects</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a><span class="st">#dsr.spp.sd ~ dunif(0.01, 1) # random species effect</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="st">#dsr.spp.tau &lt;- pow(dsr.spp.sd, -2)</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a><span class="st">#for (i in 1:n.spp){</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a><span class="st">#  eps.spp[i] ~ dnorm(0, dsr.spp.tau)</span></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="st">#}</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="st">for (i in 1:n.nests){</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a><span class="st">  for (j in 1:Freq[i]){</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="st">      # daily survival is function of mean PpnGrass, AgeFound, Age</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="st">      logitS[i,j] &lt;- dsr.mu + b.AgeFound*AgeFound[i] + b.PpnGrass*PpnGrass[i] + b.Age*Age[i]</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="st">      logit(S[i,j]) &lt;- logitS[i,j] # convert back to real scale</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="st">      } </span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="st">    IS[i] &lt;- prod(S[i,1:Freq[i]]) # prob of surviving entire exposure interval</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a><span class="st">    Fate[i] ~ dbern(IS[i]) # does nest survive this nest check interval?</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="st">  } # end jags model</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>,<span class="at">fill =</span> <span class="cn">TRUE</span>); <span class="fu">sink</span>()}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="definir-parametros-del-modelo-1" class="level2">
<h2 class="anchored" data-anchor-id="definir-parametros-del-modelo-1">Definir parametros del modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>parms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dsr.mu"</span>, <span class="st">"b.AgeFound"</span>, <span class="st">"b.PpnGrass"</span>, <span class="st">"b.Age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajustar-modelo-1" class="level2">
<h2 class="anchored" data-anchor-id="ajustar-modelo-1">Ajustar modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MCMC settings</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>na <span class="ot">&lt;-</span> <span class="dv">1000</span>; ni <span class="ot">&lt;-</span> <span class="dv">1100</span>; nt <span class="ot">&lt;-</span> <span class="dv">1</span>        </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span> <span class="dv">100</span>; nc <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># call jags (~ 4 min)</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>nest.success <span class="ot">&lt;-</span> <span class="fu">jagsUI</span>(dsr.data, <span class="at">inits =</span> <span class="cn">NULL</span>, parms, <span class="st">"dsr.jags"</span>, </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n.adapt =</span> na, <span class="at">n.chains =</span> nc, <span class="at">n.thin =</span> nt, </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n.iter =</span> ni, <span class="at">n.burnin =</span> nb, <span class="at">parallel =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Processing function input....... 

Done. 
 
Beginning parallel processing using 3 cores. Console output will be suppressed.

Parallel processing completed.

Calculating statistics....... 

Done. </code></pre>
</div>
</div>
</section>
<section id="revisar-parametros-del-modelo-1" class="level2">
<h2 class="anchored" data-anchor-id="revisar-parametros-del-modelo-1">Revisar parametros del modelo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(nest.success, <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>JAGS output for model 'dsr.jags', generated by jagsUI.
Estimates based on 3 chains of 1100 iterations,
adaptation = 1000 iterations (sufficient),
burn-in = 100 iterations and thin rate = 1,
yielding 3000 total samples from the joint posterior. 
MCMC ran in parallel for 0.049 minutes at time 2024-02-02 01:52:10.799526.

               mean     sd     2.5%      50%    97.5% overlap0     f   Rhat
dsr.mu       6.0188 0.5428   5.0095   6.0145   7.0500    FALSE 1.000 1.1090
b.AgeFound  -0.1957 0.0200  -0.2361  -0.1955  -0.1571    FALSE 1.000 1.1103
b.PpnGrass  -0.8105 0.4105  -1.6317  -0.8071  -0.0204    FALSE 0.977 1.0098
b.Age       -0.2344 0.0193  -0.2757  -0.2337  -0.1985    FALSE 1.000 1.0851
deviance   413.4444 3.4484 408.7908 412.7711 421.5707    FALSE 1.000 1.0641
           n.eff
dsr.mu        29
b.AgeFound    28
b.PpnGrass   446
b.Age         32
deviance      38

**WARNING** Rhat values indicate convergence failure. 
Rhat is the potential scale reduction factor (at convergence, Rhat=1). 
For each parameter, n.eff is a crude measure of effective sample size. 

overlap0 checks if 0 falls in the parameter's 95% credible interval.
f is the proportion of the posterior with the same sign as the mean;
i.e., our confidence that the parameter is positive or negative.

DIC info: (pD = var(deviance)/2) 
pD = 5.6 and DIC = 419.0755 
DIC is an estimate of expected predictive error (lower is better).</code></pre>
</div>
</div>
</section>
<section id="preparar-datos-a-graficar-por-edad" class="level2">
<h2 class="anchored" data-anchor-id="preparar-datos-a-graficar-por-edad">Preparar datos a graficar por edad</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">34</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>dsr_age <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>mean<span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>mean<span class="sc">$</span>b.AgeFound<span class="sc">*</span>age)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>dsr_IC2<span class="fl">.5</span>_age <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>q2<span class="fl">.5</span><span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>q2<span class="fl">.5</span><span class="sc">$</span>b.AgeFound<span class="sc">*</span>age)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>dsr_IC97<span class="fl">.5</span>_age <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>q97<span class="fl">.5</span><span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>q97<span class="fl">.5</span><span class="sc">$</span>b.AgeFound<span class="sc">*</span>age)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>Age_df_pre <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age =</span> age,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dsr =</span>dsr_age,</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">IC95L =</span> dsr_IC2<span class="fl">.5</span>_age,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">IC95H =</span> dsr_IC97<span class="fl">.5</span>_age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graficar-por-edad" class="level2">
<h2 class="anchored" data-anchor-id="graficar-por-edad">Graficar por edad</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(Age_df_pre, <span class="fu">aes</span>(<span class="at">x=</span> age, <span class="at">y =</span>dsr)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span> IC95L,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax=</span> IC95H),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha=</span> <span class="fl">0.4</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span> <span class="st">"lightgreen"</span>)<span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Clase10b_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="preparar-datos-a-graficar-por-edad-1" class="level2">
<h2 class="anchored" data-anchor-id="preparar-datos-a-graficar-por-edad-1">Preparar datos a graficar por edad</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>PpnGrass <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(mallard1<span class="sc">$</span>PpnGrass), <span class="fu">max</span>(mallard1<span class="sc">$</span>PpnGrass), <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>dsr_PpnGrass <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>mean<span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>mean<span class="sc">$</span>b.PpnGrass<span class="sc">*</span>PpnGrass)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>dsr_IC2<span class="fl">.5</span>_PpnGrass <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>q2<span class="fl">.5</span><span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>q2<span class="fl">.5</span><span class="sc">$</span>b.PpnGrass<span class="sc">*</span>PpnGrass)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>dsr_IC97<span class="fl">.5</span>_PpnGrass <span class="ot">&lt;-</span> <span class="fu">plogis</span>(nest.success<span class="sc">$</span>q97<span class="fl">.5</span><span class="sc">$</span>dsr.mu <span class="sc">+</span> nest.success<span class="sc">$</span>q97<span class="fl">.5</span><span class="sc">$</span>b.PpnGrass<span class="sc">*</span>PpnGrass)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>PpnGrass_df_pre <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PpnGrass =</span> PpnGrass,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">dsr =</span>dsr_PpnGrass,</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">IC95L =</span> dsr_IC2<span class="fl">.5</span>_PpnGrass,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">IC95H =</span> dsr_IC97<span class="fl">.5</span>_PpnGrass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="graficar-por-edad-1" class="level2">
<h2 class="anchored" data-anchor-id="graficar-por-edad-1">Graficar por edad</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(PpnGrass_df_pre, <span class="fu">aes</span>(<span class="at">x=</span> PpnGrass, <span class="at">y =</span>dsr)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span> IC95L,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax=</span> IC95H),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha=</span> <span class="fl">0.4</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill=</span> <span class="st">"lightgreen"</span>)<span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Clase10b_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HN%20Cursos%20publicidad/HN%20Biology%20Inv%20large.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">HN Biology Investigation Academy</figcaption>
</figure>
</div>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>